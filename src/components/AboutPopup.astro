---
const buildInfo = {
  timestamp: new Date().toISOString() // Build time
}
---

<!-- About popup -->
<div id="about-popup" class="about-popup">
  <div class="about-popup-content">
    <button id="close-about" class="close-about" aria-label="Close about"
      >&times;</button
    >
    <div class="about-content">
      <h2>About This App</h2>
      <p>
        This application visualizes daily global sea surface temperature data
        from NASA's OISST (Optimally Interpolated Sea Surface Temperature) dataset.
        You can view absolute temperatures or temperature anomalies (deviations from
        the long-term average for that date and location) to see how ocean
        temperatures are changing over time.
      </p>
      <p>
        You can see the current state of warming of the global sea surface temperatures,
        and focus on any region of interest. Use the mouse and its wheel or touchpad
        to zoom and pan. You should be able to see El Niño and La Niña phases forming and
        dissipating over time in the tropical Pacific, as well as the impact of hurricanes
        and typhoons and other phenomena.
      </p>
      <p>
        Note that in the anomaly dataset, the warm side of the color map
        goes more than twice as far from 0°C as the cold side.
        Due to global warming, the warmest sea surface temp anomalies are now well
        over double the coldest ones.
      </p>
      <p>
        <strong>Features:</strong>
      </p>
      <ul>
        <li>Interactive 3D globe showing global ocean temperatures</li>
        <li>Shows absolute temperature and temp anomalies</li>
        <li>View historical data by date</li>
        <li>Animate through time to see temperature trends</li>
        <li>Auto-rotate and zoom via interactive camera controls</li>
      </ul>
      <p>
        <strong>Data Source:</strong> NASA OISST daily 0.25° resolution data,
        processed by my sea-surface-temp-viz project and hosted on AWS S3.
        The color maps show temperature ranges
        from cold (blue/purple) to warm (orange/red and beyond).
      </p>
      <p>
        This is an open-source project under the MIT license.
        <br>
        Data generator:
        <a href="https://github.com/garyo/sea-surface-temp-viz" target="_blank"
        >View source code on GitHub</a>
        <br>
        This 3D Globe viewer:
        <a href="https://github.com/garyo/globe-viz" target="_blank"
          >View source code on GitHub</a
        >
      </p>
      <p
        style="font-size: 0.9rem; margin-top: 20px; display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; gap: 10px;"
      >
        <span>Created by
          <a href="https://oberbrunner.com" target="_blank">Gary Oberbrunner</a>, © 2025
        </span>
        <span class="build-info">
          [Build: {buildInfo.timestamp}]
        </span>
      </p>
    </div>
  </div>
</div>

<script>
  // About-popup functionality - handles the popup itself, not the button
  function initAboutPopup() {
    const aboutPopup = document.getElementById('about-popup')
    const closeAbout = document.getElementById('close-about')

    if (!aboutPopup || !closeAbout) {
      return
    }

    function closeAboutPopup() {
      if (aboutPopup) aboutPopup.classList.remove('show')
      document.body.style.overflow = '' // Restore scrolling
    }

    // Event listeners for closing
    closeAbout.addEventListener('click', closeAboutPopup)

    // Close on click outside content
    aboutPopup.addEventListener('click', (e) => {
      if (e.target === aboutPopup) {
        closeAboutPopup()
      }
    })

    // Close on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && aboutPopup.classList.contains('show')) {
        closeAboutPopup()
      }
    })

    // Listen for custom event to open popup
    document.addEventListener('open-about-popup', () => {
      aboutPopup.classList.add('show')
      document.body.style.overflow = 'hidden'
    })
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAboutPopup)
  } else {
    initAboutPopup()
  }
</script>

<style>
  .about-popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 2000;
    align-items: center;
    justify-content: center;
  }

  .about-popup.show {
    display: flex;
  }

  .about-popup-content {
    background-color: rgba(20, 20, 20, 0.98);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    width: 80%;
    max-width: 700px;
    max-height: 80vh;
    position: relative;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .close-about {
    position: absolute;
    top: 10px;
    right: 15px;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.9);
    font-size: 28px;
    cursor: pointer;
    z-index: 1;
    line-height: 1;
    padding: 0;
    width: 30px;
    height: 30px;
  }

  .close-about:hover {
    color: rgba(100, 150, 255, 1);
  }

  .about-content {
    padding: 25px;
    overflow-y: auto;
    max-height: 80vh;
    font-size: 0.95rem;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.95);
  }

  .about-content h2 {
    margin-bottom: 15px;
    color: rgba(100, 150, 255, 1);
    font-size: 1.5rem;
    font-weight: 600;
  }

  .about-content a {
    color: rgba(100, 150, 255, 1);
    text-decoration: underline;
  }

  .about-content a:hover {
    text-decoration: none;
  }

  .about-content p {
    margin-bottom: 12px;
  }

  .about-content ul {
    margin: 10px 0 15px 20px;
  }

  .about-content li {
    margin-bottom: 6px;
  }

  .build-info {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.5);
  }

  @media (max-width: 768px) {
    .about-popup-content {
      width: 90%;
      max-width: none;
    }

    .about-content {
      padding: 20px;
      font-size: 0.9rem;
    }

    .about-content h2 {
      font-size: 1.3rem;
    }
  }
</style>
